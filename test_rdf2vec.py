import fizzysearch
from fizzysearch.rdf2vec import use_rdf2vec
import pytest, os

import fizzysearch.rdf2vec


@pytest.fixture
def testdb():
    if not os.path.exists("testrdf2vec"):
        fizzysearch.rdf2vec.build_rdf2vec_index(["pizza.nt"], "testrdf2vec")
    yield "testrdf2vec"


def test_rewrite_rdf2vec(testdb):
    query = """select ?s where {?s <https://fizzysearch.ise.fiz-karlsruhe.de/rdf2vec> <http://www.co-ode.org/ontologies/pizza/pizza.owl#FourSeasons>}"""
    expected_query = "select ?s where {VALUES ?s {<http://www.co-ode.org/ontologies/pizza/pizza.owl#FourSeasons>}}"
    rewritten_query = fizzysearch.rewrite(
        query,
        {"https://fizzysearch.ise.fiz-karlsruhe.de/rdf2vec": use_rdf2vec(testdb, 2)},
    ).get("rewritten")

    assert rewritten_query == expected_query


if __name__ == "__main__":
    pytest.main()

"select ?s where {VALUES ?s {http://www.co-ode.org/ontologies/pizza/pizza.owl#Fiorentina http://www.co-ode.org/ontologies/pizza/pizza.owl#FishTopping http://www.w3.org/2004/02/skos/core#prefLabel http://www.co-ode.org/ontologies/pizza/pizza.owl#TomatoTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#LeekTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#DomainConcept http://www.co-ode.org/ontologies/pizza/pizza.owl#FruttiDiMare http://www.co-ode.org/ontologies/pizza/pizza.owl#HotSpicedBeefTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#SpicyPizzaEquivalent http://purl.org/dc/terms/provenance http://purl.org/dc/elements/1.1/description http://www.co-ode.org/ontologies/pizza/pizza.owl#MixedSeafoodTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#Giardiniera http://www.co-ode.org/ontologies/pizza/pizza.owl#PetitPoisTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#ThinAndCrispyBase http://www.co-ode.org/ontologies/pizza/pizza.owl#hasCountryOfOrigin http://www.co-ode.org/ontologies/pizza/pizza.owl#PrinceCarlo http://www.co-ode.org/ontologies/pizza/pizza.owl#SpicyPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#Soho http://www.co-ode.org/ontologies/pizza/pizza.owl#PineKernels http://www.co-ode.org/ontologies/pizza/pizza.owl#hasTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#Germany http://www.co-ode.org/ontologies/pizza/pizza.owl#GarlicTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#SundriedTomatoTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#Caprina http://www.co-ode.org/ontologies/pizza/pizza.owl#France http://www.co-ode.org/ontologies/pizza/pizza.owl#Napoletana http://www.co-ode.org/ontologies/pizza/pizza.owl#UnclosedPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#American http://www.co-ode.org/ontologies/pizza/pizza.owl#Country http://www.co-ode.org/ontologies/pizza/pizza.owl#VegetarianPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#PeperoniSausageTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#PolloAdAstra http://www.co-ode.org/ontologies/pizza/pizza.owl#JalapenoPepperTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#VegetarianTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#CajunSpiceTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#VegetarianPizzaEquivalent1 http://www.co-ode.org/ontologies/pizza/pizza.owl#Medium http://www.co-ode.org/ontologies/pizza/pizza.owl#CheeseTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#RealItalianPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#England http://www.co-ode.org/ontologies/pizza/pizza.owl#OnionTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#Cajun http://www.co-ode.org/ontologies/pizza/pizza.owl#RosemaryTopping http://purl.org/dc/terms/license http://www.co-ode.org/ontologies/pizza/pizza.owl#Food http://www.co-ode.org/ontologies/pizza/pizza.owl#Siciliana http://www.co-ode.org/ontologies/pizza/pizza.owl#SweetPepperTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#Margherita http://www.w3.org/2004/02/skos/core#altLabel http://www.co-ode.org/ontologies/pizza/pizza.owl#America http://www.co-ode.org/ontologies/pizza/pizza.owl#Spiciness http://www.co-ode.org/ontologies/pizza/pizza.owl#RedOnionTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#FourSeasons http://www.co-ode.org/ontologies/pizza/pizza.owl#isBaseOf http://www.co-ode.org/ontologies/pizza/pizza.owl#NutTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#PepperTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#Parmense http://www.co-ode.org/ontologies/pizza/pizza.owl#PeperonataTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#Hot http://www.co-ode.org/ontologies/pizza/pizza.owl#AnchoviesTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#hasIngredient http://www.co-ode.org/ontologies/pizza/pizza.owl#hasSpiciness http://www.co-ode.org/ontologies/pizza/pizza.owl#Veneziana http://www.co-ode.org/ontologies/pizza/pizza.owl#Rosa http://www.co-ode.org/ontologies/pizza/pizza.owl#FruitTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#AmericanHot http://purl.org/dc/terms/contributor http://www.co-ode.org/ontologies/pizza/pizza.owl#isToppingOf http://www.co-ode.org/ontologies/pizza/pizza.owl#NonVegetarianPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#DeepPanBase http://www.co-ode.org/ontologies/pizza/pizza.owl#InterestingPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#Pizza http://www.co-ode.org/ontologies/pizza/pizza.owl#ValuePartition http://www.co-ode.org/ontologies/pizza/pizza.owl#GoatsCheeseTopping http://purl.org/dc/elements/1.1/title http://www.co-ode.org/ontologies/pizza/pizza.owl#PizzaBase http://www.co-ode.org/ontologies/pizza/pizza.owl#MeatTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#hasBase http://www.co-ode.org/ontologies/pizza/pizza.owl#Italy http://www.co-ode.org/ontologies/pizza/pizza.owl#TobascoPepperSauce http://www.co-ode.org/ontologies/pizza/pizza.owl#IceCream http://www.co-ode.org/ontologies/pizza/pizza.owl#SpicyTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#isIngredientOf http://www.co-ode.org/ontologies/pizza/pizza.owl#SloppyGiuseppe http://www.co-ode.org/ontologies/pizza/pizza.owl#HerbSpiceTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#LaReine http://www.co-ode.org/ontologies/pizza/pizza.owl#GorgonzolaTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#MeatyPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#CaperTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#ParmesanTopping http://www.w3.org/2004/02/skos/core#definition http://www.co-ode.org/ontologies/pizza/pizza.owl#VegetableTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#GreenPepperTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#NamedPizza http://www.co-ode.org/ontologies/pizza/pizza.owl#PizzaTopping http://www.co-ode.org/ontologies/pizza/pizza.owl#CheeseyPizza http://www.co-ode.org/ontologies/pizza http://www.co-ode.org/ontologies/pizza/pizza.owl#SauceTopping}"
